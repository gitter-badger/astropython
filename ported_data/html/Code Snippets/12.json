{"date_published": "2010-07-25", "author": "aldcroft", "description": "<div class=\"entry\" id=\"blogbody\">\n            After doing a fit with <a href=\"http://www.astropython.org/resource/2009/10/CIAO\">Sherpa</a> you may want to dump all the results to a file for later processing or inspection.\u00a0 The following snippet writes the results from model fitting and confidence estimation to a file using the <a href=\"http://en.wikipedia.org/wiki/JSON\">JSON</a> format for data serialization.\u00a0 This format is widely supported in other programming languages and is also human-readable.<br/><br/><pre class=\"python\" name=\"code\">import json\nfrom sherpa.astro.ui import get_source, get_fit_results, get_conf_results\n\nsrc = get_source()\nfit = get_fit_results()\nconf = get_conf_results()\n              \nsrc_par_attrs = ('name', 'frozen', 'modelname', 'units', 'val', 'fullname')\nfit_attrs = ('methodname', 'statname', 'succeeded', 'statval', 'numpoints', 'dof',\n       'rstat', 'qval', 'nfev', 'message', 'parnames', 'parvals')\nconf_attrs = ('datasets', 'methodname', 'fitname', 'statname', 'sigma', 'percent',\n       'parnames', 'parvals', 'parmins', 'parmaxes', 'nfits')\n\nout = dict()\nout['src'] = dict(name=src.name,\n         pars=[dict((attr, getattr(par, attr)) for attr in src_par_attrs)\n            for par in src.pars])\nout['fit'] = dict((attr, getattr(fit, attr)) for attr in fit_attrs)\nout['conf'] = dict((attr, getattr(conf, attr)) for attr in conf_attrs)\nout['pars'] = []\n\nfor par in src.pars:\n  fullname = par.fullname\n  if any(fullname == x['name'] for x in out['pars']):\n    continue  # Parameter was already processed\n  outpar = dict(name=fullname, kind=par.name)\n\n  # None implies no calculated confidence interval for Measurement\n  parmin = None          \n  parmax = None\n  if fullname in conf.parnames:  # Confidence limits available from conf\n    i = conf.parnames.index(fullname)\n    parval = conf.parvals[i]\n    parmin = conf.parmins[i]\n    parmax = conf.parmaxes[i]\n    if parmin == None:\n      parmin = -float('inf') # None from conf means infinity, so set accordingly\n    if parmax == None:\n      parmax = float('inf')\n  elif fullname in fit.parnames: # Conf failed or par is uninteresting and wasn't sent to conf\n    i = fit.parnames.index(fullname)\n    parval = fit.parvals[i]\n  else:              # No fit or conf value (maybe frozen)\n    parval = par.val\n  out['pars'].append(outpar)\n\njson.dump(out, open('sherpa_results.json', 'w'), sort_keys=True, indent=4)\n\n</pre><p></p>\n</div>", "tags": ["sherpa", "fitting", "X-ray"], "title": "Save sherpa fit and conf results to a JSON file"}