{% extends 'base.html' %}
{% load staticfiles %}
{% load compress %}
{% block head_title %}
{{name}} Creation: 
{% endblock %}
{% block styles %}
{{form.media}}
 <link rel="stylesheet" href="{{STATIC_URL}}markdown/css/editormd.css" />
{% endblock %}
{% load crispy_forms_tags %}

{% block js %}
{% compress js %}
<script src="{{STATIC_URL}}markdown/editormd.js"></script>
<script src="{{STATIC_URL}}markdown/languages/en.js"></script>
<script src="{{STATIC_URL}}ckeditor/ckeditor.js"></script> 
<script type="text/javascript">
	$(document).ready(function(){
			var testEditormd;
			function changeEditor(){
			ch=$("#id_input_type option:selected").val();
				if (ch=="WYSIWYG")
				{
					try{
					testEditormd.editor.remove();
					$("#div_id_body > .controls").append('<textarea class="textarea form-control" cols="40" id="id_body" name="body" rows="10"></textarea>');
					}catch(err)
					{
					}
					CKEDITOR.replace( 'body' );
				}
				else{
					for(name in CKEDITOR.instances)
					{
						CKEDITOR.instances[name].destroy()
					}
					$("#id_body").replaceWith('<div id=\"test-editormd\"><textarea style="display:none;">{% if form.body.value and form.input_type.value == "Markdown" %}{{form.body.value|escapejs}}{% endif %}</textarea></div>');
					testEditormd = editormd("test-editormd", {
						width: "100%",
						height : 800,
						path : '{{STATIC_URL}}markdown/lib/',
						tex:true,
						emoji:true,
						taskList:true,
						flowChart:true, 
						sequenceDiagram:true,
						codeFold : true,
                        syncScrolling : true,
                        searchReplace : true,
                        previewCodeHighlight : true,
                        tocm : true,
                        imageUpload : false,
					});
					$(".editormd-markdown-textarea").attr("name","body");
				}
			}
			$("#id_input_type").change(function(){
				changeEditor();
				});
			changeEditor(); 
	});
</script>

{% endcompress %}
{% endblock %}
{% block content %}
<!-- *****************************************************************************************************************
TITLE WRAP
***************************************************************************************************************** -->
<section id="page-breadcrumb">
	<div class="vertical-center sun">
		 <div class="container">
			<div class="row">
				<div class="action">
					<div class="col-sm-12">
						<h1 class="title" id="title">Create {{name}} !</h1>
					</div>                                                                                
				</div>
			</div>
		</div>
	</div>
</section>
<!-- *****************************************************************************************************************
BLOG CONTENT
***************************************************************************************************************** -->
<section id="blog-details" class="padding-top">
<div class="container">
<div class="row">
	<div class="col-lg-12">
	<form method="POST">{% csrf_token %}
	{{form|crispy}}
	<button type="submit" name="submit" class="btn btn-warning">Publish</button>
	{% if user.is_authenticated %}
	<button type="submit" name="save" class="btn btn-warning">Save</button>
	{% endif %}
	</form>
	</div><! --/col-lg-8 -->
</div>
</div>
</section>
{% endblock %}
{% block endjs %}
{% endblock %}